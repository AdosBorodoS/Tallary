#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

<TransactionDetailsScreen>:
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            size_hint_y: None
            height: dp(64)
            padding: dp(16), dp(10)

            Button:
                text: "‹"
                size_hint: None, None
                size: dp(44), dp(44)
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.9,0.9,0.9,1
                font_size: sp(22)
                on_release: root.on_back_click()

            Label:
                text: "Детали транзакции"
                color: 1,1,1,1
                font_size: sp(16)
                bold: True
                halign: "center"
                valign: "middle"
                text_size: self.width, None

            Widget:
                size_hint_x: None
                width: dp(44)

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        ScrollView:
            do_scroll_x: False

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                padding: dp(16), dp(16)
                spacing: dp(16)

                Label:
                    text: "Информация о транзакции"
                    color: 1,1,1,1
                    font_size: sp(16)
                    bold: True
                    size_hint_y: None
                    height: self.texture_size[1] + dp(8)
                    halign: "left"
                    valign: "middle"
                    text_size: self.width, None

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(6)

                    Label:
                        text: "Сумма"
                        color: 0.65,0.65,0.65,1
                        font_size: sp(12)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.amountText
                        color:
                            (0.20, 0.85, 0.45, 1) if (root.amountText or "").startswith("+") else \
                            (0.95, 0.20, 0.25, 1) if (root.amountText or "").startswith("−") or (root.amountText or "").startswith("-") else \
                            (0.75, 0.75, 0.75, 1)
                        font_size: sp(16)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(4)
                        text_size: self.width, None

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(6)

                    Label:
                        text: "Описание"
                        color: 0.65,0.65,0.65,1
                        font_size: sp(12)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.descriptionText
                        color: 1,1,1,1
                        font_size: sp(13)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(6)
                        halign: "left"
                        valign: "top"
                        text_size: self.width, None

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(6)

                    Label:
                        text: "Банковское описание 1"
                        color: 0.65,0.65,0.65,1
                        font_size: sp(12)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.bankDesc1Text
                        color: 1,1,1,1
                        font_size: sp(13)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(6)
                        halign: "left"
                        valign: "top"
                        text_size: self.width, None

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(6)

                    Label:
                        text: "Банковское описание 2"
                        color: 0.65,0.65,0.65,1
                        font_size: sp(12)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.bankDesc2Text
                        color: 1,1,1,1
                        font_size: sp(13)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(6)
                        halign: "left"
                        valign: "top"
                        text_size: self.width, None

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(6)

                    Label:
                        text: "Дата"
                        color: 0.65,0.65,0.65,1
                        font_size: sp(12)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.dateText
                        color: 1,1,1,1
                        font_size: sp(13)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(6)
                        text_size: self.width, None

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(6)

                    Label:
                        text: "Счёт"
                        color: 0.65,0.65,0.65,1
                        font_size: sp(12)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.accountText
                        color: 1,1,1,1
                        font_size: sp(13)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(6)
                        text_size: self.width, None

                Widget:
                    size_hint_y: None
                    height: dp(16)

                Widget:
                    size_hint_y: None
                    height: dp(8)

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(164)
            padding: dp(16), dp(12)
            spacing: dp(10)

            Label:
                text: "Цель"
                color: 0.65,0.65,0.65,1
                font_size: sp(12)
                size_hint_y: None
                height: self.texture_size[1]
                text_size: self.width, None

            Spinner:
                id: goalSpinner
                size_hint_y: None
                height: dp(44)
                background_normal: ""
                background_color: 0.16,0.16,0.16,1
                color: 1,1,1,1
                font_size: sp(14)

                values: ["—"] + [str(g.get("goalName") or "") for g in (root.goals or [])]
                text: root.selectedGoalName if int(root.selectedGoalId or 0) > 0 else "—"
                on_text: root.on_goal_spinner_change(self.text)

            Button:
                text: "Сохранить"
                size_hint_y: None
                height: dp(44)
                disabled: root.isLoadingGoals
                background_normal: ""
                background_color: (0.30, 0.60, 0.95, 1) if not self.disabled else (0.22, 0.22, 0.22, 1)
                color: 1,1,1,1
                font_size: sp(14)
                bold: True
                on_release: root.on_save_click()

            Label:
                text: root.statusText
                color: 0.75,0.75,0.75,1
                font_size: sp(12)
                size_hint_y: None
                height: dp(18)
                text_size: self.width, None
                halign: "left"
                valign: "middle"
