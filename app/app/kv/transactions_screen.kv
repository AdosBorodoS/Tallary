#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

<TransactionItem@ButtonBehavior+BoxLayout>:
    dateText: ""
    titleText: ""
    categoryText: ""
    amountText: ""
    isIncome: False
    isNeutral: False

    orientation: "vertical"
    size_hint_y: None
    height: dp(78)
    padding: dp(16), dp(10)
    spacing: dp(6)

    background_color: 0,0,0,0

    canvas.before:
        Color:
            rgba: (0.16, 0.16, 0.16, 1) if self.state == "down" else (0, 0, 0, 0)
        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: 0.14, 0.14, 0.14, 1
        Line:
            points: self.x, self.y + self.height, self.right, self.y + self.height
            width: 1

    BoxLayout:
        orientation: "horizontal"
        spacing: dp(10)

        BoxLayout:
            orientation: "vertical"
            spacing: dp(4)

            Label:
                text: root.dateText
                size_hint_y: None
                height: dp(16)
                color: 0.55, 0.55, 0.55, 1
                font_size: sp(12)
                halign: "left"
                valign: "middle"
                text_size: self.width, None

            Label:
                text: root.titleText
                color: 1,1,1,1
                font_size: sp(13)
                bold: True
                halign: "left"
                valign: "top"
                text_size: self.width, None
                max_lines: 2

        BoxLayout:
            orientation: "vertical"
            size_hint_x: None
            width: dp(130)
            spacing: dp(6)

            Label:
                text: root.amountText
                size_hint_y: None
                height: dp(18)
                color: (1,1,1,1) if root.isNeutral else ((0.10, 0.85, 0.55, 1) if root.isIncome else (0.95, 0.20, 0.25, 1))
                font_size: sp(13)
                bold: True
                halign: "right"
                valign: "middle"
                text_size: self.width, None

            BoxLayout:
                size_hint_y: None
                height: dp(22)
                padding: dp(10), dp(0)
                size_hint_x: None
                width: dp(130)
                pos_hint: {"right": 1}

                canvas.before:
                    Color:
                        rgba: 0.06, 0.20, 0.33, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(10), dp(10), dp(10), dp(10)]

                Label:
                    text: root.categoryText
                    color: 0.45, 0.80, 1.0, 1
                    font_size: sp(10.5)
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None


<TransactionsScreen>:
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            size_hint_y: None
            height: dp(64)
            padding: dp(16), dp(10)

            Button:
                text: "–í—ã—Ö–æ–¥"
                size_hint: None, None
                size: dp(44), dp(44)
                background_normal: ""
                background_color: 0.12, 0.12, 0.12, 1
                color: 1,1,1,1
                on_release: root.on_logout_button_click()

            Widget:
                size_hint_x: None
                width: dp(44)

            Label:
                text: "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
                color: 1,1,1,1
                font_size: sp(16)
                bold: True
                halign: "center"
                valign: "middle"
                text_size: self.width, None

            Button:
                size_hint_x: None
                width: dp(40)
                text: "–î—Ä—É–∑—å—è"
                background_normal: ""
                background_color: 0, 0, 0, 0
                color: 1, 1, 1, 1
                on_release: root.on_friends_button_click()

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        BoxLayout:
            size_hint_y: None
            height: dp(126)
            padding: dp(16), dp(14)
            spacing: dp(12)
            orientation: "vertical"

            BoxLayout:
                size_hint_y: None
                height: dp(40)
                padding: dp(12), dp(0)
                spacing: dp(8)

                canvas.before:
                    Color:
                        rgba: 0.12, 0.12, 0.12, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(12), dp(12), dp(12), dp(12)]

                Label:
                    text: "üîç"
                    size_hint_x: None
                    width: dp(20)
                    color: 0.55,0.55,0.55,1
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None

                TextInput:
                    hint_text: "–ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏..."
                    text: root.searchText
                    multiline: False
                    background_normal: ""
                    background_active: ""
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    hint_text_color: 0.45,0.45,0.45,1
                    cursor_color: 1,1,1,1
                    padding: dp(0), dp(10)
                    on_text: root.on_search_text(self.text)

            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(10)

                Button:
                    text: "–î–∞—Ç–∞"
                    background_normal: ""
                    background_color: 0,0,0,0
                    color: 0.85,0.85,0.85,1
                    on_release: root.on_filter_date_click()
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    canvas.before:
                        Color:
                            rgba: 0.18, 0.18, 0.18, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(10), dp(10), dp(10), dp(10)]
                        Color:
                            rgba: 0.28, 0.28, 0.28, 1
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(10))
                            width: 1.2

                Button:
                    text: "üè∑  –ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                    background_normal: ""
                    background_color: 0,0,0,0
                    color: 0.85,0.85,0.85,1
                    on_release: root.on_filter_category_click()
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    canvas.before:
                        Color:
                            rgba: 0.18, 0.18, 0.18, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(10), dp(10), dp(10), dp(10)]
                        Color:
                            rgba: 0.28, 0.28, 0.28, 1
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(10))
                            width: 1.2

                Button:
                    text: "‚áÑ  –¢–∏–ø"
                    background_normal: ""
                    background_color: 0,0,0,0
                    color: 0.85,0.85,0.85,1
                    on_release: root.on_filter_type_click()
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    canvas.before:
                        Color:
                            rgba: 0.18, 0.18, 0.18, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(10), dp(10), dp(10), dp(10)]
                        Color:
                            rgba: 0.28, 0.28, 0.28, 1
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(10))
                            width: 1.2

        BoxLayout:
            size_hint_y: None
            height: dp(52)
            padding: dp(16), 0

            Button:
                text: "‚¨Ü –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
                size_hint_y: None
                height: dp(44)
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.27, 0.62, 0.97, 1
                bold: True
                on_release: root.on_upload_transactions_click()

                canvas.before:
                    Color:
                        rgba: 0.12, 0.12, 0.12, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(12), dp(12), dp(12), dp(12)]
                    Color:
                        rgba: 0.27, 0.62, 0.97, 0.35
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(12))
                        width: 1.2

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        BoxLayout:
            orientation: "vertical"

            Label:
                text: root.statusText
                size_hint_y: None
                height: self.texture_size[1] + dp(10) if self.text else dp(0)
                color: 0.75,0.75,0.75,1
                font_size: sp(12)
                halign: "center"
                valign: "middle"
                text_size: self.width, None

            RecycleView:
                id: rv
                viewclass: "TransactionItem"
                data: root.rvData

                RecycleBoxLayout:
                    default_size: None, dp(78)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: "vertical"

            Button:
                text: "–ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ä—ã—Ö..."
                size_hint_y: None
                height: dp(44) if root.canLoadMore else dp(0)
                opacity: 1 if root.canLoadMore else 0
                disabled: not root.canLoadMore
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.55, 0.55, 0.55, 1
                font_size: sp(12)
                halign: "center"
                valign: "middle"
                text_size: self.width, None
                on_release: root.on_load_more_click()

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        # ===== Bottom bar =====
        BoxLayout:
            size_hint_y: None
            height: dp(74)
            padding: dp(18), dp(10)
            spacing: dp(18)
            canvas.before:
                Color:
                    rgba: 0.06, 0.06, 0.06, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Button:
                id: navDashboard
                text: "–ì–ª–∞–≤–Ω–∞—è"
                halign: "center"
                valign: "middle"
                text_size: self.size
                font_size: "12sp"
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.7,0.7,0.7,1
                on_release: root.on_nav_click("home")

            Button:
                id: navTransactions
                text: "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
                halign: "center"
                valign: "middle"
                text_size: self.size
                font_size: "12sp"
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.27, 0.62, 0.97, 1
                on_release: root.on_nav_click("transactions")

            Button:
                id: navCategories
                text: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"
                halign: "center"
                valign: "middle"
                text_size: self.size
                font_size: "12sp"
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.7,0.7,0.7,1
                on_release: root.on_nav_click("categories")

            Button:
                id: navAnalytics
                text: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞"
                halign: "center"
                valign: "middle"
                text_size: self.size
                font_size: "12sp"
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.7,0.7,0.7,1
                on_release: root.on_nav_click("analytics")

            Button:
                text: "–¶–µ–ª–∏"
                halign: "center"
                valign: "middle"
                text_size: self.size
                font_size: "12sp"
                background_normal: ""
                background_color: 0,0,0,0
                color: 0.7,0.7,0.7,1
                on_release: root.on_nav_click("goals")


