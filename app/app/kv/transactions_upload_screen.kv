#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

<TransactionUploadFileItem@BoxLayout>:
    fileName: ""
    dateText: ""
    statusText: "Успешно"
    countText: "+0 транзакций"

    size_hint_y: None
    height: dp(74)
    padding: dp(12), dp(12)
    spacing: dp(10)

    canvas.before:
        Color:
            rgba: 0.10, 0.10, 0.10, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12), dp(12), dp(12), dp(12)]

    # left icon
    Label:
        text: "✔"
        size_hint_x: None
        width: dp(26)
        color: 0.20, 0.90, 0.65, 1
        font_size: sp(14)
        bold: True
        halign: "center"
        valign: "middle"
        text_size: self.size

    BoxLayout:
        orientation: "vertical"
        spacing: dp(4)

        Label:
            text: root.fileName
            color: 1,1,1,1
            font_size: sp(13)
            bold: True
            halign: "left"
            valign: "middle"
            text_size: self.size

        Label:
            text: root.dateText
            color: 0.65,0.65,0.65,1
            font_size: sp(11)
            halign: "left"
            valign: "middle"
            text_size: self.size

        BoxLayout:
            size_hint_y: None
            height: dp(18)
            spacing: dp(10)

            BoxLayout:
                size_hint_x: None
                width: dp(70)
                padding: dp(8), 0
                canvas.before:
                    Color:
                        rgba: 0.10, 0.35, 0.25, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(9), dp(9), dp(9), dp(9)]
                Label:
                    text: root.statusText
                    color: 0.20, 0.90, 0.65, 1
                    font_size: sp(10.5)
                    halign: "center"
                    valign: "middle"
                    text_size: self.size

            Label:
                text: "(" + root.countText + ")"
                color: 0.75,0.75,0.75,1
                font_size: sp(10.5)
                halign: "left"
                valign: "middle"
                text_size: self.size


<BankSourceCard@ButtonBehavior+BoxLayout>:
    bankName: "Bank"
    statusText: "Не подключено"
    formatText: "PDF"
    isConnected: False

    orientation: "vertical"
    size_hint_y: None
    height: dp(92)
    padding: dp(14), dp(14)
    spacing: dp(6)

    canvas.before:
        Color:
            rgba: 0.16, 0.16, 0.16, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(14), dp(14), dp(14), dp(14)]
        Color:
            rgba: 0.22, 0.22, 0.22, 1
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(14))
            width: 1.0

    BoxLayout:
        size_hint_y: None
        height: dp(22)

        Label:
            text: root.bankName
            color: 1,1,1,1
            font_size: sp(14)
            bold: True
            halign: "left"
            valign: "middle"
            text_size: self.size

        Widget:

        Label:
            text: "✓" if root.isConnected else ""
            size_hint_x: None
            width: dp(18)
            color: 0.75,0.75,0.75,1
            font_size: sp(14)
            bold: True
            halign: "center"
            valign: "middle"
            text_size: self.size

    Label:
        text: root.statusText
        size_hint_y: None
        height: dp(16)
        color: 0.70,0.70,0.70,1
        font_size: sp(11.5)
        halign: "left"
        valign: "middle"
        text_size: self.size

    Label:
        text: root.formatText
        size_hint_y: None
        height: dp(16)
        color: 0.85,0.85,0.85,1
        font_size: sp(11.5)
        bold: True
        halign: "left"
        valign: "middle"
        text_size: self.size


<TransactionsUploadScreen>:
    BoxLayout:
        orientation: "vertical"

        # --- Top bar ---
        BoxLayout:
            size_hint_y: None
            height: dp(64)
            padding: dp(16), dp(10)

            Button:
                text: "Назад"
                size_hint: None, None
                size: dp(44), dp(44)
                background_normal: ""
                background_color: 0,0,0,0
                color: 1,1,1,1
                on_release: root.on_back_click()

            Label:
                text: "Загрузка выписки"
                color: 1,1,1,1
                font_size: sp(16)
                bold: True
                halign: "center"
                valign: "middle"
                text_size: self.size

            Widget:
                size_hint_x: None
                width: dp(44)

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        # --- Content ---
        ScrollView:
            do_scroll_x: False

            GridLayout:
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                padding: dp(16), dp(16)
                spacing: dp(14)

                # Manual upload button
                Button:
                    text: "Загрузить транзакцию в ручную"
                    size_hint_y: None
                    height: dp(46)
                    background_normal: ""
                    background_color: 0,0,0,0
                    color: 1,1,1,1
                    bold: True
                    halign: "center"
                    valign: "middle"
                    text_size: self.size
                    on_release: root.on_manual_upload_click()
                    canvas.before:
                        Color:
                            rgba: 0.12, 0.12, 0.12, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12), dp(12), dp(12), dp(12)]
                        Color:
                            rgba: 0.25, 0.25, 0.25, 1
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(12))
                            width: 1.0

                # Bank cards
                BankSourceCard:
                    bankName: "Alfa Bank"
                    statusText: "Загрузить выписку из банка"
                    formatText: "CSV"
                    isConnected: False
                    on_release: root.on_bank_click("alfa")
                    disabled: root.isLoading

                BankSourceCard:
                    bankName: "Tinkoff"
                    statusText: "Загрузить выписку из банка"
                    formatText: "PDF"
                    isConnected: False
                    on_release: root.on_bank_click("tinkoff")
                    disabled: root.isLoading

                BankSourceCard:
                    bankName: "СберБанк"
                    statusText: "Загрузить выписку из банка"
                    formatText: "PDF"
                    isConnected: True
                    on_release: root.on_bank_click("sber")
                    disabled: root.isLoading

                Label:
                    text: root.statusText
                    size_hint_y: None
                    height: dp(34) if root.statusText else dp(0)
                    opacity: 1 if root.statusText else 0
                    color: 0.85, 0.85, 0.85, 1
                    font_size: sp(11.5)
                    halign: "left"
                    valign: "middle"
                    text_size: self.size

                # Recent files title
                Label:
                    text: "Недавно загруженные файлы"
                    size_hint_y: None
                    height: dp(24)
                    color: 1,1,1,1
                    font_size: sp(14)
                    bold: True
                    halign: "left"
                    valign: "middle"
                    text_size: self.size

                # Placeholder list (API позже)
                RecycleView:
                    id: recentRv
                    size_hint_y: None
                    height: dp(170)
                    viewclass: "TransactionUploadFileItem"
                    data: root.recentFilesRvData

                    RecycleBoxLayout:
                        default_size: None, dp(74)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(12)
                        orientation: "vertical"

                Widget:
                    size_hint_y: None
                    height: dp(18)
